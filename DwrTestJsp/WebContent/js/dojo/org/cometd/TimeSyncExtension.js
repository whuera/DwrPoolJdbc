//>>built
(function(){function d(m){return m.TimeSyncExtension=function(d){var e,n=d&&d.maxSamples||10,h=[],f=[],k=0,g=0;this.registered=function(b,a){e=a;e._debug("TimeSyncExtension: executing registration callback",void 0)};this.unregistered=function(){e._debug("TimeSyncExtension: executing unregistration callback",void 0);e=null;h=[];f=[]};this.incoming=function(b){var a=b.channel;if(a&&0===a.indexOf("/meta/")&&b.ext&&b.ext.timesync){var c=b.ext.timesync;e._debug("TimeSyncExtension: server sent timesync",
c);a=((new Date).getTime()-c.tc-c.p)/2;c=c.ts-c.tc-a;h.push(a);f.push(c);f.length>n&&(f.shift(),h.shift());for(var a=f.length,d=c=0,l=0;l<a;++l)c+=h[l],d+=f[l];k=parseInt((c/a).toFixed());g=parseInt((d/a).toFixed());e._debug("TimeSyncExtension: network lag",k)}return b};this.outgoing=function(b){var a=b.channel;a&&0===a.indexOf("/meta/")&&(b.ext||(b.ext={}),b.ext.timesync={tc:(new Date).getTime(),l:k,o:g},a=m.JSON.toJSON(b.ext.timesync),e._debug("TimeSyncExtension: client sending timesync",a));return b};
this.getTimeOffset=function(){return g};this.getTimeOffsetSamples=function(){return f};this.getNetworkLag=function(){return k};this.getServerTime=function(){return(new Date).getTime()+g};this.getServerDate=function(){return new Date(this.getServerTime())};this.setTimeout=function(b,a){var c=(a instanceof Date?a.getTime():0+a)-g-(new Date).getTime();0>=c&&(c=1);return m.Utils.setTimeout(e,b,c)}}}"function"===typeof define&&define.amd?define("org/cometd/TimeSyncExtension",["org/cometd"],d):d(org.cometd)})();
//@ sourceMappingURL=TimeSyncExtension.js.map